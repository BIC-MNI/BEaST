mincbeast - implementation of BEaST

This is a C implementation of BEaST (Brain Extraction using non-local
Segmentation Technique).

The latest BEaST source code can be found at:
https://github.com/BIC-MNI/BEaST

mincbeast works with MINC1 and MINC2 images. However, experimental
support for the NIfTI format has been added. This has not yet been
tested thoroughly.

mincbeast needs a library of priors to work (see below).

Compiling
---------
mincbeast requires either MINC or NIfTI libraries. mincbeast has been
tested on Debian type Linux systems, such as Ubuntu.
To configure type:

ccmake CMakeLists.txt

and set the right paths. Then

make
make install

Troubleshooting:
- NIFTI_ROOT should be set to /usr if you installed NIfTI libraries
using the package libnifti-dev
- If the compiler cannot find hdf5.h you probably need to install
  libhdf5-serial-dev
- If you get the message: "Could not find module FindLIBMINC.cmake or
  a configuration file for package LIBMINC.", you must point to the
  directory containing either FindLIBMINC.cmake or
  LIBMINCConfig.cmake. If you have installed MINC Tool Kit,
  http://www.bic.mni.mcgill.ca/ServicesSoftware/ServicesSoftwareMincToolKit,
  the directory is most likely /opt/minc/lib

Library
-------
The library folder MUST contain these files:
library.masks.1mm
library.masks.2mm
library.masks.4mm
library.stx.1mm
library.stx.2mm
library.stx.4mm

mincbeast will try to access these six files.

The library.stx.* files contain filenames of the normalized images at
different voxel sizes as evident from the filename (1mm, 2mm, 4mm). It
is important that the filenames are in the same order across the
library files. mincbeast uses the line number in the files to link
images at different resolutions, as well as linking the images to the
segmentations.
Similarly, the library.masks.* files contain filenames of the "expert"
segmentations at different voxel sizes.

In addition, mincbeast will by default try to access two binary masks
named margin_mask.mnc and intersection_mask.mnc. These specify respectively
which voxels to process and which voxels are automatically included in the
output segmentation. These can be manually set using -mask and -positive
and disabled using -no_mask and -no_positive.

mincbeast assumes that all images are in the same space and have the
same origin. This is not checked at runtime and will lead to errors if
it is not fulfilled.

2mm and 4mm images can be generated from the 1mm images using simple
downsampling.

mincbeast uses a simple intensity based comparison metric. Thus, it is
very important that the intensities of the library images have been
normalized.

See README.library for how to install existing libraries.

Usage
-----
mincbeast [options] <library dir> <input> <output>

<library>: path to the library
<input>: input image
<output>: output segmentation


Example
-------
mincbeast ~/beast/ t1w.mnc output.mnc -conf \\
~/beast/conf/default.1mm.conf -fill -median

Explanation of options
----------------------
 -probability:      Output the probability map instead of crisp mask.
 -flip:             Flip images around the mid-sagittal plane to increase patch count.
 -load_moments:     Do not calculate moments instead use precalculated library moments. (for optimization purposes)
 -fill:             Fill holes in the binary output.
 		    Just in case we get errors inside the mask.
 -median:           Apply a median filter on the probability map.
 		    Makes the segmentation slightly more robust, but may limit the accuracy.
 -nlm_filter:       Apply an NLM filter on the probability map (experimental).
 -verbose:          Enable verbose output.
 -clobber:          Clobber output files
 -abspath:          File paths in the library are absolute (default is relative to library root).
 -voxel_size:       Specify voxel size for calculations (4, 2, or 1). Assumes no multiscale. Use configuration file for multiscale.
                Default value: 4
 -patch_size:       Specify patch size for single scale approach.
                Default value: 1
 -search_area:      Specify size of search area for single scale approach.
                Default value: 2
 -alpha:            Specify confidence level Alpha.
                Default value: 0.5
 -beta:             Specify smoothness factor Beta.
                Default value: 0.25
 -threshold:        Specify threshold for patch selection.
                Default value: 0.95
 -selection_num:    Specify number of selected images.
                Default value: 20
 -positive:         Specify mask of positive segmentation (inside mask) instead of the default mask.
 		    This will be added to the final segmentation
 -output_selection: Specify file to output selected files.
 -count:            Specify file to output the patch count.
 -configuration:    Specify configuration file.
 		    See the 'conf' folder for example configurations.
 -mask:             Specify a segmentation mask instead of the the default mask.
 -same_resolution:  Output final mask with the same resolution as input file.
 -no_mask:          Do not apply a segmentation mask. Perform the segmentation over the entire image.
 -no_positive:      Do not apply a positive mask.



Reference
---------
Please cite BEaST as:

Simon F. Eskildsen, Pierrick Coupé, Vladimir Fonov, José V. Manjón,
Kelvin K. Leung, Nicolas Guizard, Shafik N. Wassef, Lasse R. Østergaard,
D. Louis Collins, and The Alzheimer's Disease Neuroimaging Initiative,
BEaST: Brain extraction based on nonlocal segmentation technique,
NeuroImage, vol. 59(3), pp. 2362-2373.
ISSN 1053-8119, 10.1016/j.neuroimage.2011.09.012.

Contact
-------
For questions and feedback, please contact
Simon Fristed Eskildsen <eskild@gmail.com> 
